<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>digitalian folktales</title>
    <link type="text/css" href="styles/bootstrap.css" rel="stylesheet">
    <link id="styling" type="text/css" rel="stylesheet">
    <script src="scripts/bootstrap.bundle.js"></script>
    <script src="https://d3js.org/d3.v6.js"></script>
    <link rel="stylesheet" href="https://use.typekit.net/jhe1wpv.css">
  </head>

  <body class="vh-100 ">
    <nav class="navbar navbar-expand-lg bg-light border-bottom border-body bg-body-tertiary" >
      <div class="ms-2 me-2 container-fluid">

        <nav>
          <div class="logo"><a href="#home">
              <span class="M1">M</span>
              <span class="M2">M</span>
              <span class="M3">M</span>
              <span class="M4">M</span>
          </a></div>
          <span class="subtitle">mixing maps, magazines and metadata</span>
          <!-- <span class="about"><a href="#about">about</a></span>
          <span class="past"><a href="#past">the past</a></span>
          <span class="present"><a href="#present">the present</a></span>
          <span class="future"><a href="#future">the future</a></span> -->
        </nav>

        <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
          <ul class="navbar-nav me-0 mb-2 mb-lg-0">
            
            <li class="nav-item dropdown">
              
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                the past
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="templates/folktale1-article1.html">Article 1</a></li>
                <li><a class="dropdown-item" href="templates/folktale1-article2.html">Article 2</a></li>
                <li><a class="dropdown-item" href="templates/folktale1-article3.html">Article 3</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                the present
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="templates/folktale2-article1.html">Article 1</a></li>
                <li><a class="dropdown-item" href="templates/folktale2-article2.html">Article 2</a></li>
                <li><a class="dropdown-item" href="templates/folktale2-article3.html">Article 3</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                the future
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="templates/folktale3-article1.html">Article 1</a></li>
                <li><a class="dropdown-item" href="templates/folktale3-article2.html">Article 2</a></li>
                <li><a class="dropdown-item" href="templates/folktale3-article3.html">Article 3</a></li>
              </ul>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                styling
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="switchToStyling('bootstrap.css');return false;">Bootstrap</a></li>
                <li><a class="dropdown-item" href="#" onclick="switchToStyling('alice-style-1.css');return false;">Alice - 1</a></li>
                <li><a class="dropdown-item" href="#" onclick="switchToStyling('alice-style-2.css');return false;">Alice - 2</a></li>
                <li><a class="dropdown-item" href="#" onclick="switchToStyling('francesco-style-1.css');return false;">Francesco - 1</a></li>
                <li><a class="dropdown-item" href="#" onclick="switchToStyling('francesco-style-2.css');return false;">Francesco - 2</a></li>
                <li><a class="dropdown-item" href="#" onclick="switchToStyling('kolya-style-1.css');return false;">Kolya - 1</a></li>
                <li><a class="dropdown-item" href="#" onclick="switchToStyling('kolya-style-2.css');return false;">Kolya - 2</a></li>
                <li><a class="dropdown-item" href="#" onclick="switchToStyling('liliana-style-1.css');return false;">Liliana - 1</a></li>
                <li><a class="dropdown-item" href="#" onclick="switchToStyling('liliana-style-2.css');return false;">Liliana - 2</a></li>
              </ul>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link" href="templates/about.html">
                about
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    
    
    <main  style="height: 100%;">

      <section class="map-section" >
        <div style="display: flex; justify-content: center; align-items: flex-end;">
            <!-- <span class="map-label">suggested stories</span> -->
        </div>
        <div id="map-container"  style="display: flex; flex-direction: row; justify-content: center;">
            
            <canvas id="my_dataviz" width="1200vw" height="900vh"></canvas>
            
        </div>
    
        
    
        <!-- <div class="tooltip">
                
          <span class="tooltip-contents"
              style="
                  width: fit-content;
                  margin: 2.5%;
                  display: flex;
                  flex-direction: column;
                  align-items: center;
              "
          >
    
          <div class="tooltip-close" 
          onclick="d3.select('.tooltip').style('opacity', 0)"
          style="
              position: relative;
              display: flex;
              flex-direction: row;
              width: 100%;
              justify-content: flex-end;
              text-align: right;
              font-family: 'Courier New', Courier, monospace;
              font-size: 1rem;
              line-height: 0.5rem;
              cursor: pointer;
          "
          >
              &#x00d7;
          </div>
    
    
              <div class="tooltip-header" 
                  style="
                      width: 100%; 
                      font-size: 0.8rem;
                      font-family: Courier, monospace;
                      margin-bottom: 0.5rem;
                      
                  ">
                  Gesù e San Pietro in Sicilia
              </div>
              <div class="tooltip-line" 
                  style="
                      width: 100%; 
                      font-size: 0.8rem;
                      font-family:'Courier New', Courier, monospace;
                  ">
                  <a href="gesù-e-san-pietro-in-sicilia.html" style="color: black;">explore this story</a>
              </div>
    
              <div class="tooltip-line" 
                  style="
                      width: 100%; 
                      font-size: 0.8rem;
                      font-family:'Courier New', Courier, monospace;
                  ">
                  <a href="comparison.html" style="color: black;">compare stories</a>
              </div>
    
              <div class="tooltip-line-current hidden" 
                  style="
                      width: 100%; 
                      font-size: 0.8rem;
                      font-family:'Courier New', Courier, monospace;
                  ">
                  you are here
              </div>
    
    
          </span>
    
      </div> -->
      </section> 
    


    </main>

    <footer class="sticky-bottom">
    </footer>
    
  </body>




  <script>

    // select the canvas element created in the html.
    const canvas = document.getElementById('my_dataviz');
    
    // Actual width and height. No idea if clienWidth would be a better option..?
    const width = canvas.offsetWidth
    const height = canvas.offsetHeight
    
    // Set a projection for the map. Projection = transform a lat/long on a position on the 2d map.
    const projection = d3.geoNaturalEarth1()
        .scale(width / 1.3 / Math.PI * 0.8)
        .translate([width / 2, height / 2])
    
    // Get the 'context'
    const ctx = canvas.getContext('2d');
    
    // geographic path generator for given projection and canvas context
    const pathGenerator = d3.geoPath(projection, ctx);
    
    // Draw a background
    // ctx.fillStyle = '#ddd';
    // ctx.fillRect(0, 0, width, height);
    
    // Load external data and boot
    d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson").then( function(data){
    
      // initialize the path
      ctx.beginPath();
    
      // Got the positions of the path
      pathGenerator(data);
    
      // Fill the paths
      ctx.fillStyle = "#FFF";
      ctx.fill();
    
      // Add stroke
      ctx.strokeStyle = "#555";
      ctx.stroke()
    
    })
    </script>

<script>
    const namesToURLs = [
        {
            name: 'Gesù e San Pietro in Friuli',
            url: 'analysis/gesù-e-san-pietro-in-friuli.html'
        },
        {
            name: 'Gesù e San Pietro in Sicilia',
            url: 'analysis/gesù-e-san-pietro-in-sicilia.html'
        }
]


    






    const markers = [
        {long: 13, lat: 46, fill: "#0000ff", stroke: "#3333bb", yShift: 150, title: 'Gesù e San Pietro in Friuli'}, // friuli
        {long: 14, lat: 37.56, fill: "#ff0000", stroke: "#bb3333", yShift: 150, title: 'Gesù e San Pietro in Sicilia'}, // sicily
    ];

    // The svg
    const svg = d3.select("svg")
    // Map and projection
    const projection = d3.geoMercator()
        .center([9, 47])                // GPS of location to zoom on
        .scale(2750)                       // This is like the zoom
        .translate([ 120,20 ])
    
    // Load external data and boot
    // d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson").then( function(data){
        d3.json("./topojson/it1.geojson").then( function(data){
        
        // Filter data

        // Draw the map
        svg.append("g")
            .selectAll("path")
            .data(data.features)
            .join("path")
            .attr("d", d3.geoPath()
                .projection(projection)
            )
            .style("stroke", "black") 
            .style("fill", "none") 
            

            


            const Tooltip = d3.select(".tooltip")

            



            // Three function that change the tooltip when user hover / move / leave a cell
            const mouseover = function(event, d) {
                Tooltip.style("opacity", 1)
                    .classed('hidden', false)
            }

            var mousemove = function(event, d) {
                
                d3.select('.tooltip-header')
                    .text(d.title)


                if (d.title === 'Gesù e San Pietro in Friuli') {
                    d3.select('.tooltip-line-current')
                        .classed('hidden', false)
                    d3.selectAll('.tooltip-line')
                        .classed('hidden', true)

                } else {
                    d3.select('.tooltip-line-current')
                        .classed('hidden', true)
                    d3.selectAll('.tooltip-line')
                        .classed('hidden', false)
                }

                Tooltip
                    .style("left", (event.x)/2 + "px")
                    .style("top", (event.y)/2 + d.yShift + "px")
                    .style("opacity", 1)
                    .classed('hidden', false)

                
            }

            var mouseleave = function(event, d) {
                Tooltip
                .style("left", projection([d.long, d.lat])[0] - 100 + 'px')
                .style("top", projection([d.long, d.lat])[1] -100 + 'px')
                //Tooltip.style("opacity", 0)
            }

            // Add circles:
            
            // svg
            // .selectAll("myCircles")
            // .data(markers)
            // .enter()
            // .append("circle")
            //     .attr("cx", function(d){ return projection([d.long, d.lat])[0] })
            //     .attr("cy", function(d){ return projection([d.long, d.lat])[1] })
            //     .attr("r", 14)
            //     .attr("class", "circle")
            //     .attr("fill", (d) => { return d.fill })
            //     .attr("stroke", (d) => { return d.stroke})
            //     .attr("stroke-width", 3)
            //     .attr("fill-opacity", .2)
            //     .on("mouseover", mouseover)
            //     .on("mousemove", mousemove)

                function equalToEventTarget() {
                    return this == d3.event.target;
                }

                d3.select("#map-container").on("click",function(event){
                    var outside = (document.querySelector('.tooltip') !== event.target);
                    
                    if (outside) {
                        Tooltip
                            .style("opacity", 0)
                            .classed('hidden', true)
                    }
                });
            
    })


    const slidesContainer = document.getElementById("slides-container");
    const slide = document.querySelector(".slide");
    
    // fetch('../texts/friuli-original.txt')
    // .then(response => response.text())
    // .then(text => {
    //     var node = document.querySelector('.original-text p');
    //     node.innerText = text;
    // })

    // fetch('../texts/friuli-translation.txt')
    // .then(response => response.text())
    // .then(text => {
    //     var node = document.querySelector('.translation-text p');
    //     node.innerText = text;
    // })

</script>
  <script> 
    function switchToStyling(styleName) { 
        // Obtains an array of all <link> 
        // elements. 
        // Select your element using indexing.
        var theme = document.getElementById('styling'); 

        // Change the value of href attribute  
        // to change the css sheet. 
        theme.setAttribute('href', 'styles/'+styleName); 

         
        console.log(theme)
    } 
  </script> 
</html>